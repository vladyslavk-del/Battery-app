<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    
    <!-- --- Web App Meta Tags --- -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#E0F2FE">
    <title>Battery App (Layout)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        
        html, body {
            height: 100%; /* Ensure full height */
        }
        body { 
            font-family: 'Roboto', sans-serif;
            overflow: hidden; /* Prevent scrolling on the body */
            touch-action: none; 
            -webkit-user-select: none; 
            -ms-user-select: none; 
            user-select: none; 
        }

        /* --- Styles for Home Page Battery --- */
        .app-battery-icon {
            width: 80px;
            height: 40px;
            border: 2px solid #5A6A7D;
            border-radius: 8px;
            position: relative;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .app-battery-icon::after {
            content: '';
            position: absolute;
            top: 10px;
            right: -8px;
            width: 4px;
            height: 20px;
            background: #5A6A7D;
            border-radius: 2px;
        }
        .app-battery-fill {
            position: absolute;
            top: 2px;
            left: 2px;
            height: calc(100% - 4px);
            background-color: #EF4444; /* Red for 10% */
            border-radius: 6px;
            width: 10%; /* 10% */
        }
        
        /* --- Styles for Shake Battery --- */
        .shake-battery-icon {
            width: 150px;
            height: 70px;
            border: 4px solid #5A6A7D;
            border-radius: 12px;
            position: relative;
            background: #cbd5e1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .shake-battery-icon::after {
            content: '';
            position: absolute;
            top: 18px;
            right: -12px;
            width: 8px;
            height: 30px;
            background: #5A6A7D;
            border-radius: 4px;
        }
        .shake-battery-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            border-radius: 0;
            width: 10%; /* Start at 10% */
            transition: width 0.5s linear, background-color 0.5s ease;
        }
        
        /* --- Styles for Fast Charge Battery --- */
        .vertical-battery-icon {
            width: 120px; /* Width */
            height: 220px; /* Height */
            border: 6px solid #5A6A7D;
            border-radius: 18px;
            position: relative;
            background: #cbd5e1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .vertical-battery-icon::after {
            content: '';
            position: absolute;
            top: -14px; /* On top */
            left: 50%;
            transform: translateX(-50%);
            width: 30px; /* Terminal width */
            height: 8px; /* Terminal height */
            background: #5A6A7D;
            border-radius: 4px;
        }
        .vertical-battery-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%; /* Start at 0 */
            transition: height 10s linear, background-color 0.3s ease; /* 10 sec animation */
        }

        /* --- Bubbles animation for Fast Charging --- */
        .bubbles {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 10;
        }
        .bubbles span {
            position: absolute;
            bottom: -20px; /* Start below screen */
            width: 15px;
            height: 15px;
            background-color: rgba(74, 222, 128, 0.5); /* Green bubbles */
            border-radius: 50%;
            opacity: 0;
            animation: bubble-rise 2s linear infinite;
        }
        .bubbles span:nth-child(1) { left: 20%; animation-delay: 0s; }
        .bubbles span:nth-child(2) { left: 40%; animation-delay: 0.5s; width: 10px; height: 10px; }
        .bubbles span:nth-child(3) { left: 60%; animation-delay: 1.2s; }
        .bubbles span:nth-child(4) { left: 80%; animation-delay: 1.8s; width: 12px; height: 12px; }

        @keyframes bubble-rise {
            0% {
                transform: translateY(0);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateY(-200px); /* Rise up */
                opacity: 0;
            }
        }

        /* --- General Styles --- */
        .icon-list-item {
            display: flex;
            align-items: center;
            width: 30px;
            justify-content: center;
            flex-shrink: 0;
            margin-right: 12px;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pulse-light {
            animation: pulse 1.5s infinite;
        }
        
        /* --- Status Bar Battery (Top Right) --- */
        .status-bar-battery {
            width: 25px;
            height: 12px;
            border: 1px solid currentColor;
            border-radius: 3px;
            position: relative;
            margin-right: 2px;
        }
        .status-bar-battery::after {
            content: '';
            position: absolute;
            top: 2px;
            right: -3px;
            width: 2px;
            height: 6px;
            background: currentColor;
            border-radius: 0 1px 1px 0;
        }
        .status-bar-battery-fill {
            position: absolute;
            top: 1px;
            left: 1px;
            height: calc(100% - 2px);
            border-radius: 2px;
            width: 10%; /* Start at 10% */
            transition: width 0.5s linear, background-color 0.5s ease;
        }
    </style>
</head>

<!-- Main container, full screen -->
<body class="flex flex-col h-screen bg-[#E0F2FE] text-[#1F2D3D]">

    <!-- Top Bar (Status bar + App Header) -->
    <div class="w-full bg-white text-gray-800 text-sm flex items-center justify-between p-2 relative z-10 shadow-sm flex-shrink-0">
        <div class="flex items-center space-x-2">
            <span class="font-bold text-xs">14:37</span>
            <span class="w-2 h-2 rounded-full bg-green-500"></span>
            <span class="font-bold text-gray-700">Battery App</span>
        </div>
        <div class="flex items-center space-x-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 6a2 2 0 110-4 2 2 0 010 4zm0 6a2 2 0 110-4 2 2 0 010 4zm0 6a2 2 0 110-4 2 2 0 010 4z" />
            </svg>
            
            <!-- Status bar battery (SYNCHRONIZED) -->
            <div id="statusBarBattery" class="status-bar-battery text-red-500">
                <div id="statusBarBatteryFill" class="status-bar-battery-fill bg-red-500"></div>
            </div>
            
        </div>
    </div>


    <!-- Content Area (Swappable Pages) -->
    <div classs="flex-1 overflow-y-auto">
        
        <!-- PAGE 1: HOME (Visible by default) -->
        <div id="homePage" class="flex flex-col items-center justify-start p-4">

            <!-- Battery & Percentage -->
            <div class="relative mt-8 mb-6 flex flex-col items-center justify-center flex-shrink-0">
                <div class="app-battery-icon">
                    <div class="app-battery-fill"></div>
                </div>
                <p class="text-6xl font-extrabold text-[#1F2F3D] mt-4">10<span class="text-3xl font-bold align-super">%</span></p>
            </div>

            <!-- Detect Button -->
            <button class="bg-[#4CAF50] text-white font-bold py-3 px-8 rounded-full shadow-lg text-xl mb-8 animate-pulse-light flex-shrink-0">
                DETECT
            </button>

            <!-- Info Sections -->
            <div class="w-full max-w-sm flex justify-around mb-8 flex-shrink-0">
                <div class="text-center">
                    <p class="text-gray-500 text-sm">Remaining</p>
                    <p class="text-lg font-semibold text-[#1F2F3D]">--</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-500 text-sm">Power</p>
                    <p class="text-lg font-semibold text-[#1F2F3D]">--</p>
                </div>
            </div>

            <!-- Details List -->
            <div class="w-full max-w-sm bg-white rounded-lg shadow-md py-4 px-6 mb-4 flex-shrink-0">
                <!-- Connected / On Battery -->
                <div class="flex items-center justify-between py-2 border-b border-gray-100">
                    <div class="flex items-center">
                        <div class="icon-list-item">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <span class="text-gray-700">Connected</span>
                    </div>
                    <span class="text-blue-500 font-semibold">On Battery</span>
                </div>

                <!-- Temperature -->
                <div class="flex items-center justify-between py-2 border-b border-gray-100">
                    <div class="flex items-center">
                        <div class="icon-list-item">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.61-1.56-2.99 0a3.75 3.75 0 00-2.13 1.09c-.38.38-.63.85-.75 1.34A6.002 6.002 0 0010 18a6.002 6.002 0 004.38-10.38c-.12-.49-.37-.96-.75-1.34a3.75 3.75 0 00-2.13-1.09z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <span class="text-gray-700">Temperature</span>
                    </div>
                    <span class="text-[#1F2F3D] font-semibold">33.5°C/ 92°F</span>
                </div>

                <!-- Health -->
                <div class="flex items-center justify-between py-2 border-b border-gray-100">
                    <div class="flex items-center">
                        <div class="icon-list-item">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <span class="text-gray-700">Health</span>
                    </div>
                    <span class="text-green-500 font-semibold">Good</span>
                </div>
                
                <!-- Charging Current -->
                <div class="flex items-center justify-between py-2 border-b border-gray-100">
                    <div class="flex items-center">
                        <div class="icon-list-item">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414L7.586 9H5a1 1 0 100 2h2.586l1.707 1.707a1 1 0 001.414-1.414L10.414 10l.293-.293z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <span class="text-gray-700">Charging Current</span>
                    </div>
                    <span class="text-[#1F2F3D] font-semibold">--</span>
                </div>

                <!-- Voltage -->
                <div class="flex items-center justify-between py-2 border-b border-gray-100">
                    <div class="flex items-center">
                        <div class="icon-list-item">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10H5a1 1 0 000 2h3.586l-1.293 1.293a1 1 0 101.414 1.414L12.414 10l-3.707-3.707z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <span class="text-gray-700">Voltage</span>
                    </div>
                    <span class="text-[#1F2F3D] font-semibold">--</span>
                </div>

                <!-- Capacity -->
                <div class="flex items-center justify-between py-2 border-b border-gray-100">
                    <div class="flex items-center">
                        <div class="icon-list-item">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM4.381 4.54a1 1 0 10-1.236-1.54l-.454.364A1 1 0 003 4.54V5a1 1 0 002 0V4.54zM16.76 3.004a1 1 0 00-1.236 1.54l.454.364A1 1 0 0017 4.54V4a1 1 0 00-1-1h-.24zM15 11a1 1 0 000-2h-.032a1 1 0 100 2H15zM4 11a1 1 0 100-2H3.968a1 1 0 100 2H4zm8.293 4.707a1 1 0 001.414-1.414L12.414 13H15a1 1 0 000-2h-2.586l1.293-1.293a1 1 0 10-1.414-1.414L10 12.586l-1.707-1.707a1 1 0 00-1.414 1.414L7.586 13H5a1 1 0 000 2h2.586l-1.293 1.293a1 1 0 001.414 1.414L10 15.414l1.707 1.707z" />
                            </svg>
                        </div>
                        <span class="text-gray-700">Capacity</span>
                    </div>
                    <span class="text-blue-500 font-semibold">2815 mAh</span>
                </div>

                <!-- Technology -->
                <div class="flex items-center justify-between py-2 border-b border-gray-100">
                    <div class="flex items-center">
                        <div class="icon-list-item">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2.586l.293.293A1 1 0 0010 16.586v-3.828l.293.293a1 1 0 001.414-1.414L10 9.414l-1.707-1.707a1 1 0 00-1.414 0L5 9.414V6.586a1 1 0 00-1.707-.707l-2-2a1 1 0 000-1.414l-1-1a1 1 0 00-1.414 1.414L2.586 7H1v12a1 1 0 001 1h16a1 1 0 001-1V4a1 1 0 00-1-1H11.707z" />
                            </svg>
                        </div>
                        <span class="text-gray-700">Technology</span>
                    </div>
                    <span class="text-[#1F2F3D] font-semibold">Li-ion</span>
                </div>

                <!-- Model -->
                <div class="flex items-center justify-between py-2">
                    <div class="flex items-center">
                        <div class="icon-list-item">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M7 2a2 2 0 00-2 2v12a2 2 0 002 2h6a2 2 0 002-2V4a2 2 0 00-2-2H7zm3 14a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <span class="text-gray-700">Model</span>
                    </div>
                    <span class="text-blue-500 font-semibold">iPhone 12</span>
                </div>
            </div>
        </div> <!-- End #homePage -->

        <!-- PAGE 2: TOOLS MENU (Hidden by default) -->
        <div id="toolsPage" class="hidden flex flex-col items-center justify-center p-4 h-full">
            <div class="w-full max-w-sm space-y-6">
                
                <!-- Shake to Charge Button -->
                <div id="shakeChargeButton" class="bg-white p-6 rounded-lg shadow-md flex items-center space-x-4 cursor-pointer transition-transform transform hover:scale-105">
                    <svg class="h-10 w-10 text-blue-500 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2.5m3-2.5v-6.5m0 0a1.5 1.5 0 013 0m-3 0V3m0 0a1.5 1.5 0 013 0m0 0v1.5m-3-1.5V3m0 11v6.5m0 0m0 0a1.5 1.5 0 01-3 0M10 3v1.5m0 0a1.5 1.5 0 013 0m0 0V3m0 0a1.5 1.5 0 013 0m0 0v1.5m-3-1.5V3m3 8.5v6.5m0 0a1.5 1.5 0 01-3 0m3 0V17m0 0a1.5 1.5 0 01-3 0m3 0v-1.5m0 0a1.5 1.5 0 01-3 0m0-1.5V14m0 0v-2.5" />
                    </svg>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Shake your phone to charge it</h3>
                        <p class="text-sm text-gray-500">Activates motion charging</p>
                    </div>
                </div>

                <!-- Super fast charging Button -->
                <div id="fastChargeButton" class="bg-white p-6 rounded-lg shadow-md flex items-center space-x-4 cursor-pointer transition-transform transform hover:scale-105">
                    <svg class="h-10 w-10 text-green-500 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Super fast charging</h3>
                        <p class="text-sm text-gray-500">Simulates fast charging</p>
                    </div>
                </div>

            </div>
        </div> <!-- End #toolsPage -->

        <!-- PAGE 3: SHAKE TO CHARGE (Hidden by default) -->
        <div id="shakePage" class="hidden flex flex-col items-center justify-center p-4 h-full">

            <!-- Shake Battery Block -->
            <div class="flex flex-col items-center text-center">
                
                <!-- Shake Battery Icon -->
                <div class="shake-battery-icon mb-4">
                    <!-- Lightning Bolt Animation -->
                    <svg id="shakeLightning" class="absolute h-10 w-10 text-yellow-300 z-10 hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5.2H8.5a1 1 0 00-.97 1.243l1.5 6.25A1 1 0 0010 16h.5v2.8a1 1 0 01-1.636.77l-1.5-2.25A1 1 0 006.5 17H6a1 1 0 01-1-1v-5.2h3.5a1 1 0 00.97-1.243l-1.5-6.25A1 1 0 007 2H6.5V.2a1 1 0 011.636-.77l1.5 2.25A1 1 0 0010.5 3H11a1 1 0 01.3-1.046z" clip-rule="evenodd" />
                    </svg>
                    <div id="shakeBatteryFill" class="shake-battery-fill bg-red-500"></div>
                    <span id="shakeBatteryPercent" class="relative text-3xl font-bold text-white" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">10%</span>
                </div>
                
                <p class="text-lg font-semibold text-gray-700 mt-4">Shake your phone to charge it</p>
                <p id="shakeStatus" class="text-sm text-gray-500 h-4 mt-2"></p>
            </div>

        </div> <!-- End #shakePage -->

        <!-- PAGE 4: FAST CHARGING (Hidden by default) -->
        <div id="fastChargePage" class="hidden flex flex-col items-center justify-center p-4 h-full">
            
            <!-- Vertical Battery Icon -->
            <div class="vertical-battery-icon">
                <div id="verticalBatteryFill" class="vertical-battery-fill bg-red-500"></div>
                <!-- Bubble Animation Container -->
                <div id="bubbleContainer" class="bubbles hidden">
                    <span></span><span></span><span></span><span></span>
                </div>
            </div>
            
            <!-- Percentage Display -->
            <p id="fastChargePercent" class="text-4xl font-bold text-gray-800 mb-2">0%</p>
            <p class="text-lg font-semibold text-gray-700 mb-6">Fast Charging</p>

            <!-- On/Off Button -->
            <button id="fastChargeToggleButton" class="bg-green-500 text-white font-bold py-3 px-10 rounded-full shadow-lg text-xl transition-colors duration-300">
                On
            </button>
            
        </div> <!-- End #fastChargePage -->
    </div>


    <!-- Bottom Navigation Bar -->
    <div class="w-full bg-white text-gray-600 flex justify-around items-center p-3 border-t border-gray-200 shadow-lg relative z-10 flex-shrink-0">
        
        <!-- Home Button -->
        <div id="navHomeButton" class="flex flex-col items-center cursor-pointer">
            <svg id="navHomeIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2.586l.293.293A1 1 0 0010 16.586v-3.828l.293.293a1 1 0 001.414-1.414L10 9.414l-1.707-1.707a1 1 0 00-1.414 0L5 9.414V6.586a1 1 0 00-1.707-.707l-2-2a1 1 0 000-1.414l-1-1a1 1 0 00-1.414 1.414L2.586 7H1v12a1 1 0 001 1h16a1 1 0 001-1V4a1 1 0 00-1-1H11.707z" />
            </svg>
            <span id="navHomeText" class="text-xs text-blue-500 mt-1">Home</span>
        </div>

        <!-- Tools Button -->
        <div id="navToolsButton" class="flex flex-col items-center cursor-pointer">
            <svg id="navToolsIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" viewBox="0 0 20 20" fill="currentColor">
                <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4zm4 4V6h2v2H9zm0 4v-2h2v2H9zm0 4v-2h2v2H9z" />
            </svg>
            <span id="navToolsText" class="text-xs text-gray-600 mt-1">Tools</span>
        </div>

    </div>

<script>
    // --- Page Elements ---
    const homePage = document.getElementById('homePage');
    const toolsPage = document.getElementById('toolsPage');
    const shakePage = document.getElementById('shakePage');
    const fastChargePage = document.getElementById('fastChargePage');

    // --- Navigation Elements ---
    const navHomeButton = document.getElementById('navHomeButton');
    const navHomeIcon = document.getElementById('navHomeIcon');
    const navHomeText = document.getElementById('navHomeText');
    const navToolsButton = document.getElementById('navToolsButton');
    const navToolsIcon = document.getElementById('navToolsIcon');
    const navToolsText = document.getElementById('navToolsText');

    // --- Tools Menu Buttons ---
    const shakeChargeButton = document.getElementById('shakeChargeButton');
    const fastChargeButton = document.getElementById('fastChargeButton');

    // --- Status Bar Battery (Top) ---
    const statusBarBattery = document.getElementById('statusBarBattery');
    const statusBarBatteryFill = document.getElementById('statusBarBatteryFill');

    // --- Shake Page Elements ---
    const shakeBatteryFill = document.getElementById('shakeBatteryFill');
    const shakeBatteryPercent = document.getElementById('shakeBatteryPercent');
    const shakeStatus = document.getElementById('shakeStatus');
    const shakeLightning = document.getElementById('shakeLightning');

    // --- Fast Charge Page Elements ---
    const verticalBatteryFill = document.getElementById('verticalBatteryFill');
    const fastChargePercent = document.getElementById('fastChargePercent');
    const fastChargeToggleButton = document.getElementById('fastChargeToggleButton');
    const bubbleContainer = document.getElementById('bubbleContainer');

    // --- App State ---
    let shakeLevel = 10; // Start at 10%
    let motionPermissionGranted = false;
    let isShaking = false;
    let shakeTimeout;
    let lastX, lastY, lastZ;
    let lastUpdate = 0;
    const SHAKE_THRESHOLD = 15;
    
    let isFastCharging = false;
    let fastChargePercentValue = 0;
    let fastChargeInterval;

    // --- Navigation Logic ---
    function navigateTo(pageId) {
        // Hide all pages
        homePage.classList.add('hidden');
        toolsPage.classList.add('hidden');
        shakePage.classList.add('hidden');
        fastChargePage.classList.add('hidden');

        // Deactivate all nav buttons
        navHomeIcon.classList.remove('text-blue-500');
        navHomeText.classList.remove('text-blue-500');
        navHomeIcon.classList.add('text-gray-600');
        navHomeText.classList.add('text-gray-600');
        
        navToolsIcon.classList.remove('text-blue-500');
        navToolsText.classList.remove('text-blue-500');
        navToolsIcon.classList.add('text-gray-600');
        navToolsText.classList.add('text-gray-600');

        // Stop sensors/animations
        stopShakeListener();
        if (isFastCharging) {
             // Don't stop, let it run in background, just update status bar
        }
        
        // Reset status bar to main shakeLevel unless on fast charging page
        if (pageId !== 'fastChargePage') {
            updateStatusBarBattery(shakeLevel);
        } else {
            updateStatusBarBattery(fastChargePercentValue);
        }

        // Show the target page
        if (pageId === 'home') {
            homePage.classList.remove('hidden');
            navHomeIcon.classList.add('text-blue-500');
            navHomeText.classList.add('text-blue-500');
        } else if (pageId === 'tools') {
            toolsPage.classList.remove('hidden');
            navToolsIcon.classList.add('text-blue-500');
            navToolsText.classList.add('text-blue-500');
        } else if (pageId === 'shake') {
            shakePage.classList.remove('hidden');
            navToolsIcon.classList.add('text-blue-500'); // Keep "Tools" active
            navToolsText.classList.add('text-blue-500');
            startShakeListener(); // Start sensor
        } else if (pageId === 'fastCharge') {
            fastChargePage.classList.remove('hidden');
            navToolsIcon.classList.add('text-blue-500'); // Keep "Tools" active
            navToolsText.classList.add('text-blue-500');
            // Logic for this page is handled by its button
        }
    }

    // --- Status Bar Battery Logic ---
    function updateStatusBarBattery(level) {
        const percent = Math.max(0, Math.min(100, level));
        statusBarBatteryFill.style.width = `${percent}%`;

        statusBarBattery.classList.remove('text-red-500', 'text-yellow-400', 'text-green-500');
        statusBarBatteryFill.classList.remove('bg-red-500', 'bg-yellow-400', 'bg-green-500');

        if (percent < 20) {
            statusBarBattery.classList.add('text-red-500');
            statusBarBatteryFill.classList.add('bg-red-500');
        } else if (percent < 60) {
            statusBarBattery.classList.add('text-yellow-400');
            statusBarBatteryFill.classList.add('bg-yellow-400');
        } else {
            statusBarBattery.classList.add('text-green-500');
            statusBarBatteryFill.classList.add('bg-green-500');
        }
    }

    // --- Shake to Charge Logic ---
    
    async function startShakeListener() {
        if (!('DeviceMotionEvent' in window)) {
            shakeStatus.textContent = 'Motion sensors not supported.';
            return;
        }

        if (motionPermissionGranted) {
            window.addEventListener('devicemotion', handleMotion);
            shakeStatus.textContent = 'Shake your phone!';
            return;
        }

        if (typeof DeviceMotionEvent.requestPermission === 'function') {
            try {
                shakeStatus.textContent = 'Requesting sensor access...';
                const permissionState = await DeviceMotionEvent.requestPermission();
                
                if (permissionState === 'granted') {
                    motionPermissionGranted = true;
                    window.addEventListener('devicemotion', handleMotion);
                    shakeStatus.textContent = 'Shake your phone!';
                } else {
                    shakeStatus.textContent = 'Sensor access denied.';
                }
            } catch (error) {
                shakeStatus.textContent = 'Sensor error. (Requires HTTPS)';
            }
        } else {
            // Android, etc.
            motionPermissionGranted = true;
            window.addEventListener('devicemotion', handleMotion);
            shakeStatus.textContent = 'Shake your phone!';
        }
    }

    function stopShakeListener() {
        window.removeEventListener('devicemotion', handleMotion);
        shakeStatus.textContent = '';
        if (shakeTimeout) clearTimeout(shakeTimeout);
        shakeLightning.classList.add('hidden');
    }

    function handleMotion(event) {
        const acceleration = event.accelerationIncludingGravity;
        const currentTime = Date.now();

        if (acceleration && acceleration.x !== null) {
            if (lastX === undefined) {
                lastX = acceleration.x;
                lastY = acceleration.y;
                lastZ = acceleration.z;
                return;
            }

            if ((currentTime - lastUpdate) > 100) {
                const diffX = Math.abs(acceleration.x - lastX);
                const diffY = Math.abs(acceleration.y - lastY);
                const diffZ = Math.abs(acceleration.z - lastZ);

                if ((diffX > SHAKE_THRESHOLD || diffY > SHAKE_THRESHOLD || diffZ > SHAKE_THRESHOLD)) {
                    isShaking = true;
                    shakeLightning.classList.remove('hidden');
                    shakeStatus.textContent = 'Charging!';

                    if (shakeLevel < 100) {
                        // Increase by ~1 every 100ms for 10 sec = 100%
                        // 90% in 10 sec = 9% per sec = 0.9% per 100ms. Let's use 1.
                        shakeLevel = Math.min(100, shakeLevel + 1);
                        updateShakeBattery();
                    } else {
                        shakeStatus.textContent = 'Battery Full!';
                        shakeLightning.classList.add('hidden');
                    }
                    
                    if (shakeTimeout) clearTimeout(shakeTimeout);
                    shakeTimeout = setTimeout(() => {
                        isShaking = false;
                        shakeLightning.classList.add('hidden');
                        if (shakeLevel < 100) {
                            shakeStatus.textContent = 'Shake your phone!';
                        }
                    }, 500); // 0.5 sec timeout
                }
                
                lastX = acceleration.x;
                lastY = acceleration.y;
                lastZ = acceleration.z;
                lastUpdate = currentTime;
            }
        }
    }

    function updateShakeBattery() {
        const percent = shakeLevel;
        shakeBatteryPercent.textContent = `${percent}%`;
        shakeBatteryFill.style.width = `${percent}%`;
        
        // Sync status bar
        updateStatusBarBattery(percent);

        shakeBatteryFill.classList.remove('bg-red-500', 'bg-yellow-400', 'bg-green-500');
        if (percent < 20) {
            shakeBatteryFill.classList.add('bg-red-500');
        } else if (percent < 60) {
            shakeBatteryFill.classList.add('bg-yellow-400');
        } else {
            shakeBatteryFill.classList.add('bg-green-500');
        }
    }

    // --- Fast Charging Logic ---

    function toggleFastCharge() {
        if (isFastCharging) {
            // Turn Off
            isFastCharging = false;
            fastChargeToggleButton.textContent = 'On';
            fastChargeToggleButton.classList.remove('bg-red-500');
            fastChargeToggleButton.classList.add('bg-green-500');
            
            clearInterval(fastChargeInterval);
            bubbleContainer.classList.add('hidden');

            // Reset
            fastChargePercentValue = 0;
            fastChargePercent.textContent = '0%';
            verticalBatteryFill.style.transition = 'height 0.3s ease, background-color 0.3s ease';
            verticalBatteryFill.style.height = '0%';
            verticalBatteryFill.classList.remove('bg-yellow-400', 'bg-green-500');
            verticalBatteryFill.classList.add('bg-red-500');
            updateStatusBarBattery(shakeLevel); // Reset status bar to main level
            
        } else {
            // Turn On
            isFastCharging = true;
            fastChargeToggleButton.textContent = 'Off';
            fastChargeToggleButton.classList.remove('bg-green-500');
            fastChargeToggleButton.classList.add('bg-red-500');
            
            // Reset percentage for new charge
            fastChargePercentValue = 0;
            fastChargePercent.textContent = '0%';
            verticalBatteryFill.style.transition = 'height 0s, background-color 0.3s ease';
            verticalBatteryFill.style.height = '0%';
            verticalBatteryFill.classList.remove('bg-yellow-400', 'bg-green-500');
            verticalBatteryFill.classList.add('bg-red-500');
            
            // Give the browser a tick to apply the reset
            setTimeout(() => {
                verticalBatteryFill.style.transition = 'height 10s linear, background-color 0.3s ease'; // 10 sec
                verticalBatteryFill.style.height = '100%';
                bubbleContainer.classList.remove('hidden'); 
                
                // Start percentage counter
                fastChargeInterval = setInterval(() => {
                    if (fastChargePercentValue < 100) {
                        fastChargePercentValue++;
                        fastChargePercent.textContent = `${fastChargePercentValue}%`;
                        
                        // SYNC with status bar
                        updateStatusBarBattery(fastChargePercentValue); 
                        
                        // Update color based on percentage
                        if (fastChargePercentValue === 20) {
                            verticalBatteryFill.classList.remove('bg-red-500');
                            verticalBatteryFill.classList.add('bg-yellow-400');
                        } else if (fastChargePercentValue === 60) {
                            verticalBatteryFill.classList.remove('bg-yellow-400');
                            verticalBatteryFill.classList.add('bg-green-500');
                        }
                        
                    } else {
                        clearInterval(fastChargeInterval);
                    }
                }, 100); // 100 * 100ms = 10000ms = 10 sec

            }, 50);
        }
    }

    // --- Event Listeners ---
    navHomeButton.addEventListener('click', () => navigateTo('home'));
    navToolsButton.addEventListener('click', () => navigateTo('tools'));
    shakeChargeButton.addEventListener('click', () => navigateTo('shake'));
    fastChargeButton.addEventListener('click', () => navigateTo('fastCharge'));
    fastChargeToggleButton.addEventListener('click', toggleFastCharge);

    // --- Initial Setup ---
    navigateTo('home'); // Start on the home page
    updateShakeBattery(); // Set initial 10%
    
</script>
</body>
</html>

